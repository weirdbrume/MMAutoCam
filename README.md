# MMAutoCam

MMAutoCam - бесплатная программа, предназначенная для
автоматизации процесса создания камеры для MikuMikuDance.

### Содержание:

- [Как это работает](#Как-это-работает)
- [Системные требования](#Системные-требования)
- [Установка](#Установка)
- [Для создания камеры](#Для-создания-камеры)
- [Для разработчиков](#Для-разработчиков)
- [Еше немного важной информации](#Еше-немного-важной-информации)

### Как это работает:

Для создания камеры программа использует звуковую дорожку выбранного wav-файла
и созданные заранее шаблоны камеры (выбираются в программе).
Звуковая дорожка делится на части в которых усредняются положительные значения амплитуды,
количество получившихся частей зависит от заданного в программе коэффициента свертки -
чем больше коэффициент тем меньше частей. Полученные в результате свертки части используются
для поиска переходов в камере.
Переход в камере - это место где происходит смена ракурса.
Место перехода определяется разницей значений амплитуд - максимальная разница, при которой осушествляется переход,
задается коэффициентом поиска переходов, - чем больше этот коэффициент тем меньше разница, и тем больше переходов.
По найденным переходам подставляются заданные шаблоны камеры и создается файл камеры.

### Системные требования:

ММAutoCam работает на Windows 7/8/10 x86/x64.
Для создания камеры необходимо иметь аудио файл в формате .wav (44.100/48000кГц, 16/32 бита),
а также набор шаблонов камеры (к программе прилагается 3 набора).

### Установка:

Для установки программы скачайте нужную версию архива, распакуйте в любое удобное для вас место
и запустите файл MMAutoCam.exe

- [Скачать MMAutoCam для 64-х разрядной Windows](https://github.com/weirdbrume/MMAutoCam/tree/master/bin/MMAutoCam_x64.rar)
- [Скачать MMAutoCam для 32-х разрядной Windows](https://github.com/weirdbrume/MMAutoCam/tree/master/bin/MMAutoCam_x86.rar)

### Для создания камеры:

- выберите аудио файл нажав "Выбрать wav файл"
- выберите папку с шаблонами нажав "Выбрать шаблоны камеры" (по умолчанию выбрана папка с 15 шаблонами)
- настройте коэффициент свертки, рекомендуется от 1 до 3
- настройте коэффициент поиска переходов, рекомендуется от 5 до 100
- создайте камеру нажав "Создать камеру", и выберите папку для сохранения камеры (по умолчанию папка для
  сохранения - та же, где лежит аудио файл, а имя камеры - это имя аудио файла с припиской _camera)

Полученый файл с камерой имеет тип .vmd и готов к загрузке в MikuMikuDance.

### Для разработчиков:

Программа написана на python версии 3.6.5 с использованием numpy 1.14.3 и PyQt 5.10.1
GUI для программы создан в Qt Designer (файл [MMAutoCam.ui](https://github.com/weirdbrume/MMAutoCam/blob/master/MMAutoCam.ui))
Исполняемый файл для windows создан с помощью pyinstaller 3.3.1 (параметры сборки есть в файле [pyinstaller_windows_exe_build.txt](https://github.com/weirdbrume/MMAutoCam/blob/master/pyinstaller_windows_exe_build.txt))

В файле [vmd_file_format.txt](https://github.com/weirdbrume/MMAutoCam/blob/master/vmd_file_format.txt) содержится описание формата .vmd файла с камерой

Основная логика программы осуществляется при помощи двух важных алгоритмов, далее
представлено их небольшое описание (мало ли, вдруг кто то захочет в этом поразбираться :)

###### Алгоритм поиска переходов по звуковой дорожке wav-файла:

- загружаем .wav файл
- получаем из загруженного файла массив сэмплов (значений амплитуды звука в момент времени) для всех каналов
- оставляем один канал (далее работаем с ним)
- отбрасываем отрицательные значения амплитуд
- производим свертку полученного массива (уменьшаем размер массива для дальнейшего поиска переходов)
  алгоритм свертки осуществляется следующим образом: мы в цикле проходим по массиву некоторым "окном" фиксированного
  размера (размер окна зависит от частоты дискретизации wav-файла и коэффициента задаваемого пользователем)
  и в каждом шаге цикла добавляем в новый массив среднее значение всех сэмплов в нашем "окне"
- в полученном свернутом массиве осуществляем поиск значений в которых будут находится переходы камеры
  алгоритм поиска значений для переходов камеры: в цикле проходим по массиву сэмплов и сравниваем
  абсолютное значение разницы величин соседних сэмплов с заданным порогом (значение порога получается путем
  деления максимального значения сэмпла в массиве на коэффициент поиска, заданный пользователем) - если
  разница больше порога - добавляем позицию сэмпла в массив позиций переходов
  другими словами - переходы камеры будут находится в тех местах, где разница значений соседних амплитуд
  выше заданного нами порога
- по полученным позициям интересующих нас переходов получаем значения времени (секунд) в wav-файле, где
  будут осуществляться переходы камеры

###### Алгоритм создания камеры по переходам найденным в wav-файле:

- загружаем шаблоны камеры
- создаем последовательность шаблонов
  алгоритм создания последовательности: выбираем один из загруженных шаблонов случайным образом,
  проверяем - подходит ли он под заданные условия (один и тот же шаблон не должен повторяться
  два раза подряд, так же подряд не должены повторяться шаблоны из одной категории (дальней и
  средней), кроме ближней, -  шаблоны из ближней категории не должны идти более двух раз подряд)
  если шаблон удовлетворяет условиям - добавляем его в последовательность
- вставляем шаблоны из полученной последовательности между значениями переходов, найденных по wav-файлу
  и сохраняем полученную камеру

### Еще немного важной информации:

Автором идеи программы является - [bowe4ka](https://www.youtube.com/user/bowe4ka), он же является её заказчиком,
менеджером проекта, а так же автором алгоритма поиска нужных переходов для камеры в свёрнутом массиве
сэмплов wav-файла и алгоритма создания по этим переходам камеры из шаблонов (базовые шаблоны в программе
так же созданы им, а еще иконка программы и дизайн интерфейса пользователя :)
